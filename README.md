# Multi-Grained Vision-Language Alignment for Domain Generalized Person Re-Identification

![Static Badge](https://img.shields.io/badge/Python-3.10.16-blue)
![Static Badge](https://img.shields.io/badge/PyTorch-2.6.0-orange)

Official implementation code of paper [Multi-Grained Vision-Language Alignment for Domain Generalized Person Re-Identification](TODO).

## Prerequisites
### Installation

Clone this repository:

```bash
git clone https://github.com/RikoLi/MUVA.git
cd MUVA
```

We use Python 3.10.16 and PyTorch 2.6.0. Install environments in `requirements.txt`:

```bash
pip install -r requirements.txt
```

### Visual Grounding Expert

For simplicity, we provide with the pseudo label masks generated by the Visual Grounding Expert (VGE) used in our approach. You can directly download the masks for each dataset from GoogleDrive.

- [Market1501](https://drive.google.com/file/d/1PFAhZPXUMRxlgHk89d590iQSaj2EZR5m/view?usp=drive_link)
- [DukeMTMC-reID](https://drive.google.com/file/d/1YKoWUcrisiCXwtB7vfBzgGvPMjZ0zn2B/view?usp=drive_link)
- [MSMT17](https://drive.google.com/file/d/1a6tWAcNLEkkcxJ7NBMOdIneV3UC62mct/view?usp=drive_link)
- [MA+D+MS+C3](https://drive.google.com/file/d/18BfIFQrWLAZ9Md7KKqTtw58V0JpCj5f8/view?usp=drive_link) (for multi-source generalization)

Make a directory named `blobs`. Put all downloaded `pkl` files in it.

If you want to generate masks by yourself. Please refer to [CogVLM](http://github.com/THUDM/CogVLM) to install the model with pretrained weight `cogvlm-grounding-generalist-v1.1`. After that you can refer to the script `TODO` to extract masks.

## Training

For example, train a model with given config file on specific GPU:

```bash
# e.g. MA -> MS
CUDA_VISIBLE_DEVICES=0 python train_muva.py --config_file configs/muva-full-model/muva_ma2ms.yml
```

You can create your own `yml` training configs to override the defaults.

## Evaluation

Run following script to evaluate on given target domain dataset.

```bash
# e.g. evaluate on GPU:0, checkpoint is at logs/ma2ms_full-model, target domain is DukeMTMC-reID
./scripts/test_muva_dg.sh 0 logs/ma2ms_full-model dukemtmc
```

## Acknowledgement

We would like to highly appreciate the nice works of [CogVLM](https://github.com/THUDM/CogVLM) and [CLIP-ReID](https://github.com/Syliz517/CLIP-ReID)!

## Citation

TODO